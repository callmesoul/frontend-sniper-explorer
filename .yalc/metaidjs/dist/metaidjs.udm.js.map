{"version":3,"file":"metaidjs.udm.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/popup.ts","../src/postmessage-client.ts","../src/metaidjs.ts","../src/index.ts"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","/*\n * @Author: ohosanna \n * @Date: 2020-03-18 14:45:22 \n * @Last Modified by: ohosanna\n * @Last Modified time: 2020-07-08 16:48:53\n */\n\nimport './styles/popup.css'\n\ninterface PopupOptionsTypes {\n  title?: string;\n  message: string;\n  className?: string;\n  showClose?: boolean;\n  buttonText?: string;\n  buttonText2?: string;\n  buttonUrl?: string;\n  buttonUrl2?: string;\n  buttonAction?: Function;\n  buttonAction2?: Function;\n  useCurrentWindow?:boolean;\n}\n\nclass Popup {\n  popupWrapper: HTMLElement\n  constructor() {\n    const popupEl = document.createElement('div')\n    popupEl.setAttribute('id', 'showmoney-popup')\n    document.body.appendChild(popupEl)\n    this.popupWrapper = popupEl\n  }\n  info(options: PopupOptionsTypes) {\n    this.show('info', options)\n  }\n  error(options: PopupOptionsTypes) {\n    this.show('error', options)\n  }\n  loading() {\n    console.log(this.popupWrapper)\n    this.show('info', {message: 'test'})\n  }\n  confirm(options: PopupOptionsTypes) {\n    if (!options.buttonAction) {\n      options.buttonAction = () => {\n        this.close()\n      }\n    }\n    this.show('confirm', options)\n  }\n  show(type: string = 'info', options: PopupOptionsTypes) {\n    const popupDom = this.generatePopupContent(options)\n    this.popupWrapper.appendChild(popupDom)\n    this.popupWrapper.className = type + '-popup' + ' active'\n  }\n  close() {\n    this.popupWrapper.className = ''\n    this.popupWrapper.innerHTML = ''\n  }\n  generatePopupContent(options: PopupOptionsTypes) {\n    const box = document.createElement('div')\n    box.className = 'sm-popup-box ' + (options.className ? options.className : '')\n\n    // progress\n    const progress = document.createElement('div')\n    progress.className = 'sm-linear-progress'\n    const bar1 = document.createElement('div')\n    bar1.className = 'bar bar1'\n    const bar2 = document.createElement('div')\n    bar2.className = 'bar bar2'\n    progress.appendChild(bar1)\n    progress.appendChild(bar2)\n    box.appendChild(progress)\n\n    // header\n    const popupHeader = document.createElement('header')\n    popupHeader.className = 'sm-popup-header'\n    const popupTitle = document.createElement('h2')\n    popupTitle.className = 'sm-popup-title'\n    if(options.title) {\n      popupTitle.innerHTML = options.title\n      popupHeader.appendChild(popupTitle)\n    }\n    const closeBtn = document.createElement('button')\n    closeBtn.className = 'sm-popup-close'\n    closeBtn.onclick = () => { this.close() }\n    if (options.showClose !== false) {\n      popupHeader.appendChild(closeBtn)\n    }\n\n    // content\n    const popupContent = document.createElement('div')\n    popupContent.className = 'sm-popup-content'\n    popupContent.innerHTML = options.message\n\n    // footer\n    const popupFooter = document.createElement('footer')\n    popupFooter.className = 'sm-popup-footer'\n    if(options.buttonText) {\n      const button = document.createElement('button')\n      button.className = 'sm-popup-btn sm-popup-btn1'\n      button.innerText = options.buttonText\n      if(options.buttonUrl) {\n        const url = options.buttonUrl\n        button.onclick = () => {\n          window.open(url, '_blank')\n        }\n      }\n      if (options.buttonAction) {\n        button.onclick = () => {\n          if (typeof options.buttonAction === 'function') options.buttonAction()\n        }\n      }\n      popupFooter.appendChild(button)\n    }\n    if(options.buttonText2) {\n      const button2 = document.createElement('button')\n      button2.className = 'sm-popup-btn sm-popup-btn2'\n      button2.innerText = options.buttonText2\n      if (options.buttonUrl2) {\n        const url = options.buttonUrl2\n        button2.onclick = () => {\n          if(options.useCurrentWindow){\n            window.open(url)\n          }else{\n            window.open(url, '_blank')\n          }\n        }\n      }\n      if (options.buttonAction2) {\n        button2.onclick = () => {\n          if (typeof options.buttonAction2 === 'function') options.buttonAction2()\n        }\n      }\n      popupFooter.appendChild(button2)\n    }\n\n    box.appendChild(popupHeader)\n    box.appendChild(popupContent)\n    box.appendChild(popupFooter)\n    return box\n  }\n}\n\nexport default new Popup()","// Import here Polyfills if needed. Recommended core-js (npm i -D core-js)\n// import \"core-js/fn/array.find\"\n// ...\n\nconst generateRandomId = ():string => {\n  return (Math.floor(Math.random() * 100000000000000000)).toString()\n}\n\ninterface ObjTypes<T> {\n  [key: string]: T;\n  [key: number]: T;\n}\n\nexport default class PostmessageClient {\n  handlers: ObjTypes<Function>\n  targetWindow: Window | null\n  _pendingMessages: []\n  _deliverMessages: boolean\n  _replayQueue: object\n\n  constructor (window: Window | null ) {\n    this.handlers = {}\n    this.targetWindow = window\n    this._pendingMessages = []\n    this._deliverMessages = false\n    this._replayQueue = {}\n  }\n\n  start() {\n    window.addEventListener('message', this._onMessageReceived, false)\n  }\n  finalize() {\n    window.removeEventListener('message', this._onMessageReceived, false)\n  }\n  subscribe(topic: string, handler: Function) {\n    this.handlers[topic] = handler\n  }\n  send(topic: string, payload: any, metadata = {}) {\n    if (!this.targetWindow) {\n      return console.log('请指定目标窗口')\n    }\n    const messageId = generateRandomId()\n    const message = {\n      v1: {\n        topic,\n        payload,\n        messageId,\n        ...metadata\n      }\n    }\n    this.targetWindow.postMessage(message, '*')\n    return message\n  }\n  _onMessageReceived = async (event: ObjTypes<any>) => {\n    if (!event.data || !event.data.v1) {\n      return\n    }\n    const message = event.data.v1\n    const handler = this.handlers[message.topic]\n    if (handler) {\n      try {\n        const response = await handler(message)\n        if (message.reply) {\n          this.send(`${message.topic}:reply`, response, { repliesTo: message.messageId })\n        }\n      } catch (e) {\n        console.error(e)\n        throw e\n      }\n    }\n  }\n}","import Popup from './popup'\nimport PostmessageClient from './postmessage-client'\n\ndeclare global {\n  interface Window {\n    mainFrameMessage: PostmessageClient;\n  }\n}\n\ninterface ObjTypes<T> {\n  [key: string]: T;\n  [key: number]: T;\n}\ninterface BaseParamsType {\n  accessToken: string;\n  callback?: Function;\n  onCancel?: Function;\n}\ninterface OauthSettingsTypes {\n  clientId: string;\n  redirectUri: string;\n  clientSecret?: string;\n  scope?: string;\n  responseType?: string;\n}\ninterface ResponseTypes {\n  code: number;\n  status: string;\n  handlerId?: string;\n  data: ResponseDataTypes;\n}\ninterface ResponseDataTypes {\n  message: string;\n  [key: string]: any;\n}\ninterface ConstructorOptionsTypes {\n  baseUri?: string;\n  oauthSettings: OauthSettingsTypes;\n  onLoaded?: Function;\n  onError?: Function;\n}\nexport interface ProtocolOptions {\n  nodeName: string;\n  version?: string;\n  data?: string;\n  dataType?: string;\n  encoding?: string;\n  parentTxId?: string;\n  encrypt?: number | string;\n  metaIdTag?: string;\n  keyPath?: string;\n  parentAddress?: string;\n  needConfirm?: boolean;\n  checkOnly?: boolean;\n  brfcId?: string;\n  path: string;\n  nodeKey?: string;\n  payCurrency?: string;\n  payTo?: SendToTypes[];\n  autoRename?: boolean;\n}\ninterface SendToTypes {\n  address: string;\n  amount: number;\n}\ninterface ProtocolParamsTypes extends ProtocolOptions, BaseParamsType {\n  accessToken: string;\n  handlerId?: string;\n}\n\nconst generateRandomId = (): string => {\n  return (Math.floor(Math.random() * 100000000000000000)).toString()\n}\nconst hasClass = (el: HTMLElement, cls: string) => {\n  return el.className.match(new RegExp('(\\\\s|^)' + cls + '(\\\\s|$)'))\n}\nconst addClass = (el: HTMLElement, cls: string) => {\n  if (!hasClass(el, cls)) el.className += \" \" + cls\n}\nexport class MetaIdJs {\n  postMessage = new PostmessageClient(window)\n  oauthSettings: OauthSettingsTypes\n  mainFrameEl: HTMLIFrameElement | null = null\n  SHOWMONEY_URL: string\n  accessToken = ''\n  isInjectMainFrame = false\n  isLoaded = false\n  _handlers: ObjTypes<any> = {}\n  onLoaded: Function | undefined\n  onError: Function = (res: ResponseTypes) => {\n    Popup.error({\n      message: res.data.message\n    })\n  }\n\n  constructor(options: ConstructorOptionsTypes) {\n    this.SHOWMONEY_URL = options.baseUri || \"https://www.showmoney.app\"\n    this.onLoaded = options.onLoaded\n    if (typeof options.onError === 'function') {\n      this.onError = options.onError\n    }\n    this.oauthSettings = {\n      ...options.oauthSettings,\n      clientSecret: '',\n      scope: 'app',\n      responseType: 'code'\n    }\n    this.init()\n  }\n\n  /**\n   * injectMainFrame  注入主框架\n   */\n  public injectMainFrame() {\n    const mainFrame = document.createElement('iframe')\n    const mainFrameWrapper = document.createElement('div')\n    mainFrame.setAttribute('id', 'showmoney-main-frame')\n    mainFrame.setAttribute('src', this.SHOWMONEY_URL + '/iframe')\n    mainFrameWrapper.setAttribute('id', 'mainframewrapper')\n    mainFrameWrapper.setAttribute('style', 'display: none;')\n    mainFrameWrapper.appendChild(mainFrame)\n    document.body.appendChild(mainFrameWrapper)\n    // 报告 main-frame 载入完成\n    mainFrame.onload = () => {\n      if (mainFrame.contentWindow) {\n        this.mainFrameEl = mainFrame\n        // 无法把postmessage实例保留，会报跨域错误\n        window.mainFrameMessage = new PostmessageClient(mainFrame.contentWindow)\n        window.mainFrameMessage.send('send-options', this.oauthSettings)\n        // window.mainFrameMessage = mainFrameMessage\n        this.isInjectMainFrame = true\n        // console.log('mainFrame loaded')\n      }\n    }\n  }\n  private initHandle() {\n    const functionObj = [\n      \"swapreqswapargs\",\n      \"estimateSwapToken2Amount\",\n      \"estimateSwapToken1Amount\",\n      \"isSupportedFt\",\n      \"swapft\",\n      \"getBalance\",\n      \"nftBuy\",\n      \"nftCancel\",\n      \"nftSell\",\n      \"genesisNFT\",\n      \"issueNFT\",\n    ]\n    for (const item of functionObj) {\n      (this as any)[item] = function (params: {\n        accessToken: string;\n        callback?: Function;\n        data: string;\n      }) {\n        const defParams: ObjTypes<any> = params\n        if (params.callback) {\n          const handlerId = generateRandomId()\n          this._handlers[handlerId] = {}\n          this._handlers[handlerId].callback = params.callback\n          defParams.handlerId = handlerId\n        }\n        delete defParams.callback\n        window.mainFrameMessage.send(item, defParams)\n      }\n    }\n  }\n  /**\n   * getUserInfo\n   */\n  public getUserInfo(params: {\n    accessToken: string;\n    callback?: Function;\n  }) {\n    const defParams: ObjTypes<any> = params\n    if (params.callback) {\n      const handlerId = generateRandomId()\n      this._handlers[handlerId] = {}\n      this._handlers[handlerId].callback = params.callback\n      defParams.handlerId = handlerId\n    }\n    delete defParams.callback\n    window.mainFrameMessage.send('get-user-info', defParams)\n  }\n  /**\n   * signMessage\n   */\n  public signMessage(params: {\n    accessToken: string;\n    callback?: Function;\n    data: string;\n  }) {\n    const defParams: ObjTypes<any> = params\n    if(params.callback) {\n      const handlerId = generateRandomId()\n      this._handlers[handlerId] = {}\n      this._handlers[handlerId].callback = params.callback\n      defParams.handlerId = handlerId\n    }\n    delete defParams.callback\n    window.mainFrameMessage.send('sign-messgae', defParams)\n  }\n  /**\n   * eciesEncryptData\n   */\n  public eciesEncryptData(params: {\n    accessToken: string;\n    callback?: Function;\n    data: string;\n  }) {\n    const defParams: ObjTypes<any> = params\n    if(params.callback) {\n      const handlerId = generateRandomId()\n      this._handlers[handlerId] = {}\n      this._handlers[handlerId].callback = params.callback\n      defParams.handlerId = handlerId\n    }\n    delete defParams.callback\n    window.mainFrameMessage.send('ecies-encrypt-data', defParams)\n  }\n  public eciesDecryptData(params: {\n    accessToken: string;\n    callback?: Function;\n    data: string;\n  }) {\n    const defParams: ObjTypes<any> = params\n    if(params.callback) {\n      const handlerId = generateRandomId()\n      this._handlers[handlerId] = {}\n      this._handlers[handlerId].callback = params.callback\n      defParams.handlerId = handlerId\n    }\n    delete defParams.callback\n    window.mainFrameMessage.send('ecies-decrypt-data', defParams)\n  }\n  /**\n   * ecdhEncryptData\n   */\n  public ecdhEncryptData(params: {\n    accessToken: string;\n    callback?: Function;\n    data: string;\n  }) {\n    const defParams: ObjTypes<any> = params\n    if(params.callback) {\n      const handlerId = generateRandomId()\n      this._handlers[handlerId] = {}\n      this._handlers[handlerId].callback = params.callback\n      defParams.handlerId = handlerId\n    }\n    delete defParams.callback\n    window.mainFrameMessage.send('ecdh-encrypt-data', defParams)\n  }\n  public ecdhDecryptData(params: {\n    accessToken: string;\n    callback?: Function;\n    data: string;\n  }) {\n    const defParams: ObjTypes<any> = params\n    if(params.callback) {\n      const handlerId = generateRandomId()\n      this._handlers[handlerId] = {}\n      this._handlers[handlerId].callback = params.callback\n      defParams.handlerId = handlerId\n    }\n    delete defParams.callback\n    window.mainFrameMessage.send('ecdh-decrypt-data', defParams)\n  }\n  public getFTList(params: {\n    accessToken: string;\n    callback?: Function;\n    data?: string;\n  }) {\n    const defParams: ObjTypes<any> = params\n    if(params.callback) {\n      const handlerId = generateRandomId()\n      this._handlers[handlerId] = {}\n      this._handlers[handlerId].callback = params.callback\n      defParams.handlerId = handlerId\n    }\n    delete defParams.callback\n    window.mainFrameMessage.send('get-ftlist', defParams)\n  }\n  // 版本兼容\n  public addProtocolNode(params: ProtocolParamsTypes) {\n    this.sendMetaDataTx(params)\n  }\n  /**\n   * createProtocolNode\n   */\n  public sendMetaDataTx(params: ProtocolParamsTypes) {\n    if (!params.checkOnly) {\n      this.showLoadingPopup()\n    }\n    if (params.callback || params.onCancel) {\n      const handlerId = generateRandomId()\n      this._handlers[handlerId] = {}\n      if (params.callback) {\n        this._handlers[handlerId]['callback'] = params.callback\n      }\n      if (params.onCancel) {\n        this._handlers[handlerId]['onCancel'] = params.onCancel\n      }\n      params = {\n        ...params,\n        handlerId: handlerId\n      }\n      delete params.callback\n      delete params.onCancel\n    }\n    if (this.isInjectMainFrame) {\n      window.mainFrameMessage.send('create-node', params)\n      // console.log(this._handlers)\n    } else {\n      throw new Error('showmoney frame 未加载')\n    }\n  }\n\n  public payToAddress(params: {\n    accessToken: string;\n    callback?: Function;\n    data: string;\n  }){\n    const defParams: ObjTypes<any> = params\n    if(params.callback) {\n      const handlerId = generateRandomId()\n      this._handlers[handlerId] = {}\n      this._handlers[handlerId].callback = params.callback\n      defParams.handlerId = handlerId\n    }\n    delete defParams.callback\n    window.mainFrameMessage.send('pay-to-address', defParams)\n  }\n  private handleCreateNodeSuccess = (res: ObjTypes<any>) => {\n    Popup.close()\n    this.mainFrameEl?.parentElement?.setAttribute('style', 'display: none;')\n    const payload = res.payload\n    const callback = this._handlers[payload.handlerId].callback\n    if (callback) {\n      callback(payload)\n    }\n  }\n  private showLoadingPopup() {\n    const popupEl = document.getElementById('showmoney-popup')\n    if (!popupEl) return\n    Popup.info({\n      message: 'Processing data...',\n      showClose: false\n    })\n    addClass(popupEl, 'loading')\n  }\n  private handleCreateNodeError = (res: ObjTypes<any>) => {\n    const payload = res.payload\n    Popup.close()\n    Popup.error({\n      message: payload.data && payload.data.message ? payload.data.message : res\n    })\n  }\n  private handleConfirmCreateNode = (res: ObjTypes<any>) => {\n    // console.log(\"confirm\", res);\n    Popup.close()\n    this.mainFrameEl?.parentElement?.removeAttribute('style')\n  }\n  private handleCloseCreateNode = (res: ObjTypes<any>) => {\n    Popup.close()\n    this.mainFrameEl?.parentElement?.setAttribute('style', 'display: none;')\n    const payload = res.payload\n    const callback = this._handlers[payload.handlerId].onCancel\n    if (callback) {\n      delete payload.handlerId\n      callback(payload)\n    }\n  }\n  private handleErrorNotLoggedIn(resolve: ObjTypes<any>) {\n    const message = resolve.payload\n    Popup.close()\n    Popup.info(message.popup)\n  }\n  private handleCallback = (res: ObjTypes<any>) => {\n    const payload = res.payload\n    const callback = this._handlers[payload.handlerId].callback\n    if (callback) {\n      delete payload.handlerId\n      callback(payload)\n    }\n  }\n  private handleSdkLoaded = () => {\n    this.isLoaded = true\n    if (typeof this.onLoaded === 'function') {\n      this.onLoaded()\n    }\n  }\n  private handleCommonError = (res: ObjTypes<any>) => {\n    console.log('error', res)\n    const payload = res.payload\n    Popup.close()\n    if (payload.code === 202) {\n      Popup.confirm({\n        message: 'User authentication expired.',\n        showClose: false,\n        buttonText: 'Cancel',\n        buttonText2: 'Login',\n        buttonUrl2: `${this.SHOWMONEY_URL}/userLogin?response_type=code&client_id=${this.oauthSettings.clientId}&redirect_uri=${this.oauthSettings.redirectUri}&scope=app&from=${this.oauthSettings.redirectUri}`\n      })\n    } else {\n      this.onError(payload)\n    }\n  }\n  private handleLoading = () => {\n    this.showLoadingPopup()\n  }\n  private handleNotEnoughMoney = (res: ObjTypes<any>) => {\n    const payload = res.payload\n    const message = payload.data.message\n    Popup.close()\n    Popup.confirm({\n      message: message ? message : 'Not enough money',\n      showClose: false,\n      buttonText: 'Cancel',\n      buttonText2: 'Top up BSV',\n      buttonUrl2: this.SHOWMONEY_URL,\n      buttonAction: () => {\n        Popup.close()\n        if ((window as any).handleNotEnoughMoney) {\n          (window as any).handleNotEnoughMoney(payload)\n        }\n        // const callback = this._handlers[payload.handlerId].callback\n        // if (callback) {\n        //   callback(payload)\n        // }\n      }\n    })\n  }\n  private init() {\n    this.injectMainFrame()\n\n    // 监听信息\n    this.postMessage.start()\n    this.initHandle()\n    this.postMessage.subscribe('sdk-loaded', this.handleSdkLoaded)\n    this.postMessage.subscribe('error.not-logged-in', this.handleErrorNotLoggedIn)\n    this.postMessage.subscribe('loading', this.handleLoading)\n    this.postMessage.subscribe('success.create-node', this.handleCreateNodeSuccess)\n    this.postMessage.subscribe('confirm.create-node', this.handleConfirmCreateNode)\n    this.postMessage.subscribe('close.create-node', this.handleCloseCreateNode)\n    this.postMessage.subscribe('error.create-node', this.handleCreateNodeError)\n    this.postMessage.subscribe('error.not-enough-money', this.handleNotEnoughMoney)\n    this.postMessage.subscribe('receive-callback', this.handleCallback)\n    this.postMessage.subscribe('error.common', this.handleCommonError)\n  }\n}","import { MetaIdJs } from \"./metaidjs\"\n\ndeclare global {\n  interface Window {\n    MetaIdJs?: Function; \n    handleNotEnoughMoney?: Function; \n  }\n}\n\nwindow.MetaIdJs = MetaIdJs\n\nexport default MetaIdJs"],"names":["css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","popupEl","setAttribute","body","this","popupWrapper","Popup","options","show","console","log","message","buttonAction","_this","close","popupDom","generatePopupContent","className","innerHTML","box","progress","bar1","bar2","popupHeader","popupTitle","title","closeBtn","onclick","showClose","popupContent","popupFooter","buttonText","button","innerText","buttonUrl","url_1","window","open","buttonText2","button2","buttonUrl2","url_2","useCurrentWindow","buttonAction2","event","data","v1","handler","handlers","topic","response","_a","reply","send","repliesTo","messageId","error","e_1","targetWindow","_pendingMessages","_deliverMessages","_replayQueue","PostmessageClient","addEventListener","_onMessageReceived","removeEventListener","payload","metadata","Math","floor","random","toString","postMessage","generateRandomId","addClass","el","cls","match","RegExp","hasClass","res","mainFrameEl","parentElement","callback","_handlers","handlerId","removeAttribute","onCancel","isLoaded","onLoaded","code","confirm","SHOWMONEY_URL","oauthSettings","clientId","redirectUri","onError","showLoadingPopup","handleNotEnoughMoney","baseUri","clientSecret","scope","responseType","init","MetaIdJs","mainFrame","mainFrameWrapper","onload","contentWindow","mainFrameMessage","isInjectMainFrame","item","this_1","params","defParams","functionObj_1","_i","sendMetaDataTx","checkOnly","Error","getElementById","info","resolve","popup","injectMainFrame","start","initHandle","subscribe","handleSdkLoaded","handleErrorNotLoggedIn","handleLoading","handleCreateNodeSuccess","handleConfirmCreateNode","handleCloseCreateNode","handleCreateNodeError","handleCallback","handleCommonError"],"mappings":"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"}